{% extends 'blank.html' %}
{% load  staticfiles %}
{% load  mytag %}
{% block title %}
测量记录数据信息
{% endblock %}
{% block topbar_title %}
测量记录数据信息
{% endblock %}
{% block other_css %}
<!-- Custom styles for this page -->
<link href="{% static 'vendor/datatables/dataTables.bootstrap4.min.css' %}" rel="stylesheet">
<link href="{% static 'css/bootstrap-select.min.css' %}" rel="stylesheet">
<style>
    option:nth-child(1) {
        display: none;
    }
</style>
{% endblock %}

{% block head_scripts %}
<script src="{% static 'polyfill.js' %}"></script>
<script src="{% static 'cascader.js' %}"></script>
<script src="{% static 'china-area.js' %}"></script>

{% endblock %}

{% block page_content %}
<div class="container-fluid" style="font-size:14px">
<ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'index' %}">主页</a></li>
        <li class="breadcrumb-item"><a href="{% url 'select2_device' %}">测量记录</a></li>
        <li class="breadcrumb-item active">数据查看</li>
    </ol>
    <!-- Page Heading -->
    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="alert" style="display: none;"></div>
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary"></h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>采集时间</th>
                            {% for desc in desc_list %}
                            <th>{{ desc.desc }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
{#                    <tfoot>#}
{#                    <tr>#}
{#                        <th></th>#}
{#                        {% for desc in desc_list %}#}
{#                            <th>{{ desc }}</th>#}
{#                        {% endfor %}#}
{#                    </tr>#}
{#                    </tfoot>#}
                </table>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block other_js %}

<!-- Page level plugins -->
<script src="{% static 'vendor/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'vendor/datatables/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'laydate/laydate.js' %}"></script>
<!-- Page level custom scripts -->
<script src="{% static 'js/demo/datatables-demo.js' %}"></script>
<script src="{% static 'js/bootstrap-select.min.js' %}"></script>
<script src="{% static 'js/defaults-zh_CN.min.js' %}"></script>
<script>
        $(function () {
            reloadDatatables()
        });
        var reloadDatatables = function () {
            {#console.log('触发了');#}
            var tables = $('#dataTable').DataTable({
                select: 'single',
                destroy: true,
                'bAutoWidth': false,
                "pagingType": "full_numbers",
                "language": {
                    "decimal": "",
                    "info": "显示 _START_ 条 至 _END_ 条 共 _TOTAL_ 条数据",
                    "infoEmpty": "没有数据",
                    "emptyTable": "没有数据",
                    "infoFiltered": "(从总数 _MAX_ 条中 过滤)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "每页显示 _MENU_ 条数据",
                    "loadingRecords": "加载中...",
                    "processing": "处理中...",
                    "search": "搜索:",
                    "zeroRecords": "没有搜索到数据",
                    "paginate": {
                        "first": "第一页",
                        "last": "最后一页",
                        "next": "下一页",
                        "previous": "上一页"
                    },
                    "aria": {
                        "sortAscending": ": 点击以按升序排序",
                        "sortDescending": ": 点击以按降序排序"
                    }
                },
                "autoWidth": false,	//禁用自动调整列宽
                "processing": true,//载入数据的时候是否显示“载入中”
                "aLengthMenu": [[100, 50, 25, 10], [100, 50, 25, 10]],//设置每页显示数据条数的下拉选项
                'iDisplayLength': 100, //每页初始显示5条记录
                "searching": false,//去掉搜索框
                "deferRender": true,
                "ordering": false,
                "serverSide": true, //开启服务器模式
                "ajax": function (data, callback) {
                    {#console.log(data.order);#}
                    var dataStr = $("#filterDataForm").serialize() + "&draw=" + data.draw + "&start=" + data.start + "&length=" + data.length + "&page=" + (data.start / data.length + 1);
                    $.ajax({
                        cache: false,
                        type: "POST",
                        dataType: 'json',
                        url: "{% url 'record_location_info' record_id %}",
                        data: dataStr,
                        async: true,
                        success: function (res) {
                            {#console.log(res);#}
                            var returnData = {};
                            returnData.draw = res.draw; // 计数器
                            returnData.recordsTotal = res.recordsTotal;//返回数据全部记录
                            returnData.recordsFiltered = res.recordsFiltered;//过滤后记录
                            returnData.data = res.data; // 数据对象
                            {#console.log(returnData.data);#}
                            callback(returnData);
                            {#console.log(returnData)#}
                        },
                        error: function () {
                            alert('错误');
                        }
                    })
                },
            });
        }
    </script>
{#<script>#}
{#    $(function () {#}
{#        $('#exportExcel').click(function () {#}
{#            $('.alert').addClass('alert-success').html('Excle正在导出，请耐心等待').show().delay(1500).fadeOut();#}
{#            $.ajax({#}
{#                cache: false,#}
{#                type: "POST",#}
{#                dataType: 'json',#}
{#                url: "{% url 'export_location_info' %}",#}
{#                data: $('#filterDataForm').serialize(),#}
{#                async: true,#}
{#                success: function (data) {#}
{#                    if (data.status === 'success') {#}
{#                        $('.alert').addClass('alert-success').html('数据导出成功，请点击文件名称进行下载')#}
{#                            .show().delay(1500).fadeOut();#}
{#                    } else {#}
{#                        $('.alert').addClass('alert-success').html('数据导出失败，或没有数据导出').show()#}
{#                            .delay(3000).fadeOut();#}
{#                    }#}
{#                    var href = data.media_url;#}
{#                    var file = data.file;#}
{#                    if (href === undefined) {#}
{#                        href = "#";#}
{#                    }#}
{#                    if (file === undefined) {#}
{#                        file = '没有数据导出'#}
{#                    }#}
{#                    $("#all_button").append(#}
{#                        '<button type="button" class="btn-sm btn-success"><a href="' +#}
{#                        href + '">' + file + '</a></button>' + '&nbsp;');#}
{##}
{#                }#}
{#            });#}
{#        });#}
{#    })#}
{#</script>#}
{% endblock %}